<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–≥–∞–¥–∞–π, –∫—Ç–æ —è ‚Äî –ú–∏—à–∞ –∏ –ê–Ω—é—Ç–∞</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #2b5876, #4e4376);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://i.imgur.com/2cOaJ.png') repeat;
      opacity: 0.3;
      animation: twinkle 10s infinite;
      z-index: -1;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.5; }
    }
    .container {
      display: flex;
      gap: 30px;
      padding: 30px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .game-board {
      display: grid;
      grid-template-columns: repeat(4, 120px);
      gap: 15px;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }
    .card {
      width: 120px;
      height: 180px;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: transform 0.6s, box-shadow 0.3s;
      transform-style: preserve-3d;
    }
    .card:hover {
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    }
    .card.flipped {
      transform: rotateY(180deg);
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      backface-visibility: hidden;
    }
    .card .back {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1e3a8a, #6b7280);
      transform: rotateY(180deg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 16px;
      backface-visibility: hidden;
      border-radius: 10px;
    }
    .chat {
      width: 350px;
      background: rgba(255, 255, 255, 0.15);
      padding: 20px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    #chat-messages {
      height: 400px;
      overflow-y: auto;
      padding: 15px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.2);
    }
    .message {
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .message.user1 {
      background: #60a5fa;
      align-self: flex-start;
    }
    .message.user2 {
      background: #f472b6;
      align-self: flex-end;
    }
    #chat-input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }
    #chat-input::placeholder {
      color: #ccc;
    }
    button, select {
      padding: 10px 20px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover, select:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }
    button:disabled, select:disabled {
      background: #6b7280;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    h1 {
      font-size: 32px;
      text-align: center;
      background: linear-gradient(45deg, #facc15, #f472b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 20px 0;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    .game-selector {
      margin-bottom: 20px;
      text-align: center;
    }
    .error-message {
      color: #f87171;
      text-align: center;
      margin: 20px;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        align-items: center;
      }
      .game-board {
        grid-template-columns: repeat(3, 100px);
      }
      .card {
        width: 100px;
        height: 150px;
      }
      .chat {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <div class="stars"></div>
  <h1>–£–≥–∞–¥–∞–π, –∫—Ç–æ —è ‚Äî –ú–∏—à–∞ –∏ –ê–Ω—é—Ç–∞</h1>
  <div class="game-selector">
    <select id="game-select" onchange="loadCharacters()">
      <option value="genshin">Genshin Impact</option>
      <option value="honkai">Honkai Star Rail</option>
    </select>
  </div>
  <div class="container">
    <div class="game-board" id="game-board"></div>
    <div class="chat">
      <div id="chat-messages"></div>
      <input type="text" id="chat-input" placeholder="–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ—Ç–≤–µ—Ç—å –î–∞/–ù–µ—Ç üòä">
      <button id="send-button" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button id="guess-button" onclick="guess()">–£–≥–∞–¥–∞—Ç—å!</button>
    </div>
  </div>
  <div id="error-message" class="error-message"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <!-- GSAP –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <script>
    // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const firebaseConfig = {
      apiKey: "AIzaSyA-qRTFlszcMafJv1eesYg-PUxsxYoo28U",
      authDomain: "misha-and-anna-48e4c.firebaseapp.com",
      databaseURL: "https://misha-and-anna-48e4c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "misha-and-anna-48e4c",
      storageBucket: "misha-and-anna-48e4c.firebasestorage.app",
      messagingSenderId: "822036073579",
      appId: "1:822036073579:web:cd59fd4f5362b5f0bb752e",
      measurementId: "G-XR86X6PXMX"
    };

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let database = null;
    const errorMessage = document.getElementById("error-message");

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
    function showError(message) {
      errorMessage.textContent = message;
      console.error(message);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    function initializeFirebase() {
      try {
        firebase.initializeApp(firebaseConfig);
        database = firebase.database();
        console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ");
        return true;
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase: " + error.message);
        return false;
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤
    function checkDOMElements() {
      const gameSelect = document.getElementById("game-select");
      const gameBoard = document.getElementById("game-board");
      const chatMessages = document.getElementById("chat-messages");
      const chatInput = document.getElementById("chat-input");
      const sendButton = document.getElementById("send-button");
      const guessButton = document.getElementById("guess-button");

      if (!gameSelect || !gameBoard || !chatMessages || !chatInput || !sendButton || !guessButton) {
        showError("–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.");
        return false;
      }
      return { gameSelect, gameBoard, chatMessages, chatInput, sendButton, guessButton };
    }

    // –°–ø–∏—Å–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    const characters = {
      genshin: [
        { name: "–ù–µ–≤–∏–ª–ª–µ—Ç", img: "https://i.pinimg.com/736x/90/fc/72/90fc7293c09cccb104b55b00e5fc9d9d.jpg" },
        { name: "–°—Ç—Ä–∞–Ω–Ω–∏–∫", img: "https://i.pinimg.com/originals/f0/1e/70/f01e701d6d82ffeac1c6ce6102d774d5.jpg" },
        { name: "–†–∞–π–¥–µ–Ω", img: "https://genshin.ch/templates/assets/img/ai_collec/052/wallpaper/f00042-2667934761.webp" },
        { name: "–§—É—Ä–∏–Ω–∞", img: "https://i.ytimg.com/vi/fao4JOuJyCo/maxresdefault.jpg?sqp=-oaymwEmCIAKENAF8quKqQMa8AEB-AHgCYAC0AWKAgwIABABGEQgSShlMA8=&amp;rs=AOn4CLCVPMJTX5M31imafIQ3eAn09DpgOg" },
        { name: "–ß–∂—É–Ω –õ–∏", img: "https://avatars.mds.yandex.net/get-mpic/4114383/img_id1690362300544799707.jpeg/orig" },
        { name: "–í–µ–Ω—Ç–∏", img: "https://upload-os-bbs.hoyolab.com/upload/2024/11/15/327952485/0cf91a2d4a324dcefc261c1a21ca9ae2_1057402059431960410.jpg?x-oss-process=image%2Fresize%2Cs_1000%2Fauto-orient%2C0%2Finterlace%2C1%2Fformat%2Cwebp%2Fquality%2Cq_70" },
        { name: "–ö–∞–¥–∑—É—Ö–∞", img: "https://i.pinimg.com/originals/c4/88/bb/c488bb009fdafd339dce7734754d77d5.jpg" },
        { name: "–Ø—ç –ú–∏–∫–æ", img: "https://i.pinimg.com/550x/34/61/ac/3461ac66141d119d34bd66d8e8ac4a79.jpg" },
        { name: "–ì–∞–Ω—å –Æ–π", img: "https://i.pinimg.com/originals/a9/29/95/a929959cb3e893ad8123f46eed96e722.jpg" },
        { name: "–•—É –¢–∞–æ", img: "https://i.ytimg.com/vi/7GdrGchWWIk/maxresdefault.jpg" },
        { name: "–§—Ä–µ–º–∏–Ω–µ", img: "https://wotpack.ru/wp-content/uploads/2023/07/word-image-271120-2.jpeg" },
        { name: "–°—è–æ", img: "https://i.pinimg.com/736x/05/ce/44/05ce441907dd503d2d41cd35bc1908b3.jpg" }
      ],
      honkai: [
        { name: "–î–∞–Ω –•—ç–Ω", img: "https://i.pinimg.com/736x/06/1e/b6/061eb6b9f45e647814419e43ce8e762b.jpg" },
        { name: "–ú–∞—Ä—Ç–∞ 7", img: "https://avatars.mds.yandex.net/i?id=932f3a94c884c2fd2f6ec7c9869c3606_l-10135049-images-thumbs&n=13" },
        { name: "–ö–∞—Ñ–∫–∞", img: "https://distribution.faceit-cdn.net/images/d5671a15-0841-4518-a7c7-91b4e76dbb67.jpeg" },
        { name: "–ë–ª—ç–π–¥", img: "https://i.pinimg.com/originals/1b/c1/a0/1bc1a00ee34ce4538680ec653c18c04d.png" },
        { name: "–ó–µ–ª–µ", img: "https://avatars.mds.yandex.net/i?id=4fc806cb8eea60a59511f5f07c540d59_l-12184992-images-thumbs&n=13" },
        { name: "–ê–≤–∞–Ω—Ç—é—Ä–∏–Ω", img: "https://avatars.mds.yandex.net/get-yapic/38135/TdnyZm3KNDg6x8hYSlRW2fghQU-1/orig" },
        { name: "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", img: "https://www.pcinvasion.com/wp-content/uploads/2024/05/Honkai-Star-Rail-Sunday.jpg?fit=1280%2C720" },
        { name: "–•–∏–º–µ–∫–æ", img: "https://i.ytimg.com/vi/kZoSXXnW3g4/maxresdefault.jpg" },
        { name: "–ê—Ö–µ—Ä–æ–Ω", img: "https://i.pinimg.com/originals/07/b7/d1/07b7d12670f1ea58bf91230f85c300df.png" },
        { name: "–õ–æ—á–∞", img: "https://www.goha.ru/s/E:N1/pN/m3jVvYO0ys.jpg" },
        { name: "–°–≤–µ—Ç–ª—è—á–æ–∫", img: "https://i.pinimg.com/originals/00/64/b7/0064b73b42970aa36ff32e617ebb758f.jpg" },
        { name: "–ê–≥–ª–∞—è", img: "https://i.pinimg.com/736x/75/08/b7/7508b7407c0ae1b13f0745a0afee6fe9.jpg" }
      ]
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    function loadCharacters() {
      const elements = checkDOMElements();
      if (!elements) return;

      const { gameSelect, gameBoard } = elements;
      const game = gameSelect.value;
      gameBoard.innerHTML = "";
      characters[game].forEach((char, index) => {
        const card = document.createElement("div");
        card.classList.add("card");
        card.dataset.index = index;
        card.innerHTML = `
          <img src="${char.img}" alt="${char.name}">
          <div class="back">?</div>
        `;
        card.addEventListener("click", () => flipCard(index));
        gameBoard.appendChild(card);
        gsap.from(card, { opacity: 0, y: 20, duration: 0.5, delay: index * 0.1 });
      });
      document.body.style.background = game === "genshin"
        ? "linear-gradient(135deg, #2b5876, #4e4376)"
        : "linear-gradient(135deg, #1e1b4b, #3b0764)";
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    function sendMessage() {
      const elements = checkDOMElements();
      if (!elements) return;

      const { chatInput } = elements;
      const text = chatInput.value.trim();
      if (text && database) {
        try {
          database.ref("chat").push({
            user: prompt("–¢–≤–æ–µ –∏–º—è (–ú–∏—à–∞ –∏–ª–∏ –ê–Ω—é—Ç–∞)?") || "–ò–≥—Ä–æ–∫",
            text: text
          });
          chatInput.value = "";
        } catch (error) {
          showError("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: " + error.message);
        }
      }
    }

    // –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
    function flipCard(index) {
      const card = document.querySelector(`.card[data-index="${index}"]`);
      if (!card) {
        showError(`–ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º ${index} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
        return;
      }
      if (!database) {
        showError("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
        return;
      }
      try {
        card.classList.toggle("flipped");
        database.ref(`cards/${index}`).set({
          flipped: card.classList.contains("flipped")
        });
        gsap.to(card, { rotationY: card.classList.contains("flipped") ? 180 : 0, duration: 0.6 });
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏: " + error.message);
      }
    }

    // –£–≥–∞–¥—ã–≤–∞–Ω–∏–µ
    function guess() {
      if (!database) {
        showError("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
        return;
      }
      const guess = prompt("–ö—Ç–æ —ç—Ç–æ? –í–≤–µ–¥–∏ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:");
      if (guess) {
        try {
          database.ref("chat").push({
            user: "–ò–≥—Ä–∞",
            text: `–£–≥–∞–¥–∞–Ω–æ: ${guess}! –í—ã–±–µ—Ä–∏ –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.`
          });
        } catch (error) {
          showError("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≥–∞–¥—ã–≤–∞–Ω–∏—è: " + error.message);
        }
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    function initializeGame() {
      const elements = checkDOMElements();
      if (!elements) {
        document.getElementById("game-select").disabled = true;
        document.getElementById("send-button").disabled = true;
        document.getElementById("guess-button").disabled = true;
        return;
      }

      const { chatMessages, chatInput } = elements;

      if (!initializeFirebase()) {
        elements.gameSelect.disabled = true;
        elements.sendButton.disabled = true;
        elements.guessButton.disabled = true;
        return;
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
      try {
        loadCharacters();
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π: " + error.message);
        return;
      }

      // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
      try {
        database.ref("chat").on("child_added", (snapshot) => {
          try {
            const msg = snapshot.val();
            const msgDiv = document.createElement("div");
            msgDiv.classList.add("message", `user${msg.user === "–ú–∏—à–∞" ? 1 : 2}`);
            msgDiv.textContent = `${msg.user}: ${msg.text}`;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            gsap.from(msgDiv, { opacity: 0, x: msg.user === "–ú–∏—à–∞" ? -20 : 20, duration: 0.3 });
          } catch (error) {
            showError("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: " + error.message);
          }
        }, (error) => {
          showError("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —á–∞—Ç: " + error.message);
        });
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–∞—Ç–∞: " + error.message);
      }

      // –°–ª—É—à–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
      try {
        database.ref("cards").on("value", (snapshot) => {
          try {
            const cardsState = snapshot.val();
            if (cardsState) {
              Object.keys(cardsState).forEach((index) => {
                const card = document.querySelector(`.card[data-index="${index}"]`);
                if (card) {
                  if (cardsState[index].flipped) {
                    card.classList.add("flipped");
                  } else {
                    card.classList.remove("flipped");
                  }
                }
              });
            }
          } catch (error) {
            showError("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫: " + error.message);
          }
        }, (error) => {
          showError("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏: " + error.message);
        });
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫: " + error.message);
      }

      // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Enter
      try {
        chatInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendMessage();
        });
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–≤–æ–¥–∞: " + error.message);
      }
    }

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    initializeGame();
  </script>
</body>
</html>
