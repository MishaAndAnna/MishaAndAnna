<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Наш Музыкальный Плейлист</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
       :root {
    /* Modern color palette */
    --primary-color: #6c5ce7;
    --primary-light: #a29bfe;
    --secondary-color: #00cec9;
    --secondary-light: #81ecec;
    --dark-color: #2d3436;
    --light-color: #ffffff;
    --accent-color: #fd79a8;
    --background-color: #f8f9fa;
    --gray-100: #f8f9fa;
    --gray-200: #e9ecef;
    --gray-300: #dee2e6;
    --gray-400: #ced4da;
    --gray-500: #adb5bd;
    --gray-600: #6c757d;
    --gray-700: #495057;
    --gray-800: #343a40;
    --gray-900: #212529;
    
    /* Typography */
    --body-font: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    --heading-font: 'Poppins', var(--body-font);
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-xxl: 3rem;
    
    /* Borders */
    --border-radius-sm: 0.25rem;
    --border-radius-md: 0.5rem;
    --border-radius-lg: 1rem;
    --border-radius-xl: 1.5rem;
    --border-radius-circle: 50%;
    
    /* Shadows */
    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    
    /* Transitions */
    --transition-fast: 150ms ease;
    --transition-normal: 300ms ease;
    --transition-slow: 500ms ease;
}

/* Base styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    font-size: 16px;
    scroll-behavior: smooth;
}

body {
    font-family: var(--body-font);
    background: var(--background-color);
    background-image: 
        radial-gradient(at 40% 20%, rgba(var(--primary-color), 0.03) 0px, transparent 50%),
        radial-gradient(at 80% 0%, rgba(var(--secondary-color), 0.03) 0px, transparent 50%),
        radial-gradient(at 0% 50%, rgba(var(--accent-color), 0.03) 0px, transparent 50%);
    min-height: 100vh;
    color: var(--gray-800);
    line-height: 1.6;
    overflow-x: hidden;
}

a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color var(--transition-fast);
}

a:hover {
    color: var(--primary-light);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    font-family: var(--heading-font);
    line-height: 1.2;
    color: var(--gray-900);
    margin-bottom: var(--spacing-md);
    font-weight: 700;
}

h1 {
    font-size: 3.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-fill-color: transparent;
    margin-bottom: var(--spacing-lg);
    text-shadow: none;
}

h2 {
    font-size: 2.5rem;
}

h3 {
    font-size: 2rem;
}

/* Layout */
.container {
    width: 100%;
    max-width: 1280px;
    margin: 0 auto;
    padding: var(--spacing-md);
}

/* Header */
header {
    text-align: center;
    padding: var(--spacing-xxl) 0;
    position: relative;
    overflow: hidden;
    margin-bottom: var(--spacing-xl);
}

.header-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('/api/placeholder/1200/300');
    background-size: cover;
    background-position: center;
    opacity: 0.15;
    z-index: -1;
    border-radius: var(--border-radius-lg);
    transform: scale(1.05);
    filter: blur(8px);
}

.subtitle {
    font-size: 1.3rem;
    margin-bottom: var(--spacing-xl);
    color: var(--gray-600);
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-xl);
    border-radius: var(--border-radius-md);
    font-weight: 600;
    font-size: 1rem;
    letter-spacing: 0.02em;
    cursor: pointer;
    transition: all var(--transition-normal);
    border: none;
    outline: none;
    text-transform: uppercase;
    font-size: 0.875rem;
}

.btn-primary {
    background-color: var(--primary-color);
    color: white;
    box-shadow: 0 4px 14px rgba(108, 92, 231, 0.4);
}

.btn-primary:hover {
    background-color: var(--primary-light);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(108, 92, 231, 0.5);
}

.btn-secondary {
    background-color: var(--secondary-color);
    color: white;
    box-shadow: 0 4px 14px rgba(0, 206, 201, 0.4);
}

.btn-secondary:hover {
    background-color: var(--secondary-light);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0, 206, 201, 0.5);
}

.btn-accent {
    background-color: var(--accent-color);
    color: white;
    box-shadow: 0 4px 14px rgba(253, 121, 168, 0.4);
}

.btn-accent:hover {
    background-color: #ff8eb8;
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(253, 121, 168, 0.5);
}

/* Playlist Header */
.playlist-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
    flex-wrap: wrap;
    gap: var(--spacing-md);
}

.playlist-title {
    font-size: 2rem;
    color: var(--gray-800);
    position: relative;
    padding-bottom: var(--spacing-sm);
}

.playlist-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 4px;
    background: linear-gradient(to right, var(--primary-color), var(--accent-color));
    border-radius: var(--border-radius-sm);
}

.buttons-container {
    display: flex;
    gap: var(--spacing-md);
}

.add-song-btn, .add-playlist-btn {
    background-color: var(--accent-color);
    color: white;
    border: none;
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--border-radius-lg);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-normal);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    box-shadow: var(--shadow-md);
}

.add-song-btn:hover, .add-playlist-btn:hover {
    background-color: #ff8eb8;
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

/* Playlist Container */
.playlist-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--spacing-xl);
    margin-top: var(--spacing-xl);
}

/* Song Card */
.song-card {
    background-color: var(--light-color);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    transition: all var(--transition-normal);
    position: relative;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.song-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-xl);
}

.vinyl-container {
    position: relative;
    padding: var(--spacing-lg);
    display: flex;
    justify-content: center;
    background: linear-gradient(135deg, var(--gray-100), var(--gray-200));
    border-bottom: 1px solid var(--gray-200);
}

.vinyl {
    width: 130px;
    height: 130px;
    background: radial-gradient(circle at center, #222 0%, #000 80%);
    border-radius: var(--border-radius-circle);
    position: relative;
    transition: all var(--transition-slow);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1;
}

.vinyl::before {
    content: '';
    position: absolute;
    width: 40%;
    height: 40%;
    background-color: var(--light-color);
    border-radius: var(--border-radius-circle);
    box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.2);
}

.vinyl::after {
    content: '';
    position: absolute;
    width: 10%;
    height: 10%;
    background-color: var(--gray-800);
    border-radius: var(--border-radius-circle);
    z-index: 2;
}

.grooves {
    position: absolute;
    width: 90%;
    height: 90%;
    border-radius: var(--border-radius-circle);
    border: 1px solid rgba(255, 255, 255, 0.1);
    pointer-events: none;
}

.grooves::before {
    content: '';
    position: absolute;
    top: 15%;
    left: 15%;
    right: 15%;
    bottom: 15%;
    border-radius: var(--border-radius-circle);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.grooves::after {
    content: '';
    position: absolute;
    top: 30%;
    left: 30%;
    right: 30%;
    bottom: 30%;
    border-radius: var(--border-radius-circle);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.song-card.playing .vinyl {
    animation: rotating 5s linear infinite;
}

@keyframes rotating {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

.song-image {
    position: absolute;
    width: 75px;
    height: 75px;
    border-radius: var(--border-radius-circle);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 0;
    object-fit: cover;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    border: 3px solid var(--light-color);
}

.song-content {
    padding: var(--spacing-lg);
    flex: 1;
    display: flex;
    flex-direction: column;
}

.song-title {
    font-size: 1.5rem;
    margin-bottom: var(--spacing-xs);
    color: var(--gray-900);
    font-weight: 700;
    line-height: 1.3;
}

.song-artist {
    font-size: 1rem;
    color: var(--gray-600);
    margin-bottom: var(--spacing-lg);
    font-weight: 500;
}

.song-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
}

.play-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    width: 48px;
    height: 48px;
    border-radius: var(--border-radius-circle);
    cursor: pointer;
    transition: all var(--transition-normal);
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: var(--shadow-md);
}

.play-btn:hover {
    background-color: var(--primary-light);
    transform: scale(1.1);
    box-shadow: 0 6px 12px rgba(108, 92, 231, 0.4);
}

.play-btn i {
    font-size: 1.2rem;
}

.song-metadata {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.song-duration, .song-category {
    font-size: 0.85rem;
    color: var(--gray-500);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
    opacity: 0;
    transition: opacity var(--transition-normal);
}

.modal.active {
    display: flex;
    opacity: 1;
}

.modal-content {
    background-color: var(--light-color);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-xl);
    width: 90%;
    max-width: 550px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    box-shadow: var(--shadow-xl);
    transform: translateY(20px);
    opacity: 0;
    transition: all var(--transition-normal);
}

.modal.active .modal-content {
    transform: translateY(0);
    opacity: 1;
}

.close-btn {
    position: absolute;
    top: var(--spacing-lg);
    right: var(--spacing-lg);
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray-600);
    transition: color var(--transition-fast);
}

.close-btn:hover {
    color: var(--accent-color);
}

.modal-title {
    font-size: 1.8rem;
    margin-bottom: var(--spacing-lg);
    color: var(--primary-color);
    text-align: center;
}

/* Form Elements */
.form-group {
    margin-bottom: var(--spacing-lg);
}

label {
    display: block;
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
    color: var(--gray-700);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

input, select, textarea {
    width: 100%;
    padding: var(--spacing-md);
    border: 2px solid var(--gray-300);
    border-radius: var(--border-radius-md);
    font-size: 1rem;
    transition: border-color var(--transition-fast);
    background-color: var(--gray-100);
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
}

.submit-btn {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    color: white;
    border: none;
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--border-radius-md);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-normal);
    width: 100%;
    margin-top: var(--spacing-md);
    box-shadow: 0 4px 14px rgba(108, 92, 231, 0.4);
}

.submit-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(108, 92, 231, 0.5);
}

/* Playlist Selector */
.playlist-selector {
    margin-bottom: var(--spacing-lg);
}

.playlist-tabs {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: var(--spacing-md);
    gap: var(--spacing-xs);
}

.playlist-tab {
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    background-color: var(--gray-200);
    color: var(--gray-700);
    font-weight: 500;
    font-size: 0.9rem;
}

.playlist-tab:hover {
    background-color: var(--gray-300);
}

.playlist-tab.active {
    background-color: var(--primary-color);
    color: white;
}

/* Footer */
footer {
    text-align: center;
    padding: var(--spacing-xxl) 0;
    margin-top: var(--spacing-xxl);
    color: var(--gray-600);
    background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.03));
    border-top: 1px solid var(--gray-200);
}

.footer-content {
    max-width: 600px;
    margin: 0 auto;
}

.heart {
    color: var(--accent-color);
    display: inline-block;
    animation: heartbeat 1.5s infinite;
}

@keyframes heartbeat {
    0% { transform: scale(1); }
    25% { transform: scale(1.1); }
    50% { transform: scale(1); }
    75% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: var(--spacing-xxl) 0;
    color: var(--gray-600);
    background-color: var(--gray-100);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-sm);
}

.empty-state-icon {
    font-size: 4rem;
    color: var(--gray-400);
    margin-bottom: var(--spacing-lg);
}

.empty-state-text {
    font-size: 1.3rem;
    margin-bottom: var(--spacing-xl);
    color: var(--gray-600);
}

.empty-state-action {
    margin-top: var(--spacing-lg);
}

/* Loading State */
.loading {
    position: relative;
    width: 50px;
    height: 50px;
    margin: var(--spacing-xl) auto;
}

.loading div {
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: var(--border-radius-circle);
    background-color: var(--primary-color);
    animation: loading 1.2s linear infinite;
}

.loading div:nth-child(1) {
    top: 0;
    left: 0;
    animation-delay: 0s;
}

.loading div:nth-child(2) {
    top: 0;
    right: 0;
    animation-delay: 0.4s;
}

.loading div:nth-child(3) {
    bottom: 0;
    right: 0;
    animation-delay: 0.8s;
}

.loading div:nth-child(4) {
    bottom: 0;
    left: 0;
    animation-delay: 1.2s;
}

@keyframes loading {
    0%, 100% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(0.5);
        opacity: 0.5;
    }
}

/* Tooltip */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltiptext {
    visibility: hidden;
    width: 120px;
    background-color: var(--gray-800);
    color: var(--light-color);
    text-align: center;
    border-radius: var(--border-radius-sm);
    padding: var(--spacing-sm);
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity var(--transition-normal);
    font-size: 0.85rem;
}

.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}

/* Media Queries */
@media (max-width: 1024px) {
    .container {
        padding: var(--spacing-md);
    }
    
    h1 {
        font-size: 3rem;
    }
    
    .playlist-container {
        gap: var(--spacing-lg);
    }
}

@media (max-width: 768px) {
    html {
        font-size: 15px;
    }
    
    h1 {
        font-size: 2.5rem;
    }
    
    .playlist-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .buttons-container {
        width: 100%;
        justify-content: flex-start;
    }
    
    .playlist-container {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    
    .vinyl {
        width: 110px;
        height: 110px;
    }
    
    .song-image {
        width: 65px;
        height: 65px;
    }
}

@media (max-width: 480px) {
    html {
        font-size: 14px;
    }
    
    h1 {
        font-size: 2.2rem;
    }
    
    .playlist-container {
        grid-template-columns: 1fr;
    }
    
    .add-song-btn, .add-playlist-btn {
        width: 100%;
        justify-content: center;
    }
    
    .buttons-container {
        flex-direction: column;
        width: 100%;
    }
    
    .vinyl-container {
        padding: var(--spacing-md);
    }
    
    .vinyl {
        width: 100px;
        height: 100px;
    }
    
    .song-image {
        width: 60px;
        height: 60px;
    }
    
    .modal-content {
        padding: var(--spacing-lg);
    }
}

/* Dark Mode */
@media (prefers-color-scheme: dark) {
    :root {
        --light-color: #1a1a2e;
        --background-color: #0f0f1a;
        --gray-100: #1a1a2e;
        --gray-200: #16213e;
        --gray-300: #252850;
        --gray-700: #c8c8d8;
        --gray-800: #e1e1e9;
        --gray-900: #ffffff;
    }
    
    body {
        background-image: 
            radial-gradient(at 40% 20%, rgba(108, 92, 231, 0.1) 0px, transparent 50%),
            radial-gradient(at 80% 0%, rgba(0, 206, 201, 0.1) 0px, transparent 50%),
            radial-gradient(at 0% 50%, rgba(253, 121, 168, 0.1) 0px, transparent 50%);
    }
    
    .vinyl-container {
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        border-bottom: 1px solid #252850;
    }
    
    .empty-state {
        background-color: var(--gray-100);
    }
    
    input, select, textarea {
        background-color: #16213e;
        border-color: #252850;
        color: var(--gray-800);
    }
    
    /* Add other specific dark mode adjustments as needed */
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-background"></div>
            <h1>Наша Музыкальная История</h1>
            <p class="subtitle">Песни, которые рассказывают историю нашей любви</p>
        </header>

        <div class="playlist-selector">
            <select id="playlist-select">
                <option value="all">Все песни</option>
            </select>
        </div>

        <div class="playlist-header">
            <h2 class="playlist-title">Наш плейлист</h2>
            <div>
                <button class="add-song-btn" id="add-song-btn">
                    <i class="fas fa-plus"></i>
                    Добавить песню
                </button>
                <button class="add-playlist-btn" id="add-playlist-btn">
                    <i class="fas fa-list"></i>
                    Создать плейлист
                </button>
            </div>
        </div>

        <div class="playlist-container" id="playlist-container"></div>

        <div id="add-song-modal" class="modal">
            <div class="modal-content">
                <button class="close-btn" id="close-add-modal">×</button>
                <h2 class="modal-title">Добавить новую песню</h2>
                <form id="add-song-form">
                    <div class="form-group">
                        <label for="song-file">Выберите аудиофайл</label>
                        <input type="file" id="song-file" accept="audio/*" required>
                    </div>
                    <div class="form-group">
                        <label for="song-playlist">Добавить в плейлист</label>
                        <select id="song-playlist">
                            <option value="none">Не добавлять</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">Добавить песню</button>
                </form>
            </div>
        </div>

        <div id="add-playlist-modal" class="modal">
            <div class="modal-content">
                <button class="close-btn" id="close-playlist-modal">×</button>
                <h2 class="modal-title">Создать новый плейлист</h2>
                <form id="add-playlist-form">
                    <div class="form-group">
                        <label for="playlist-name">Название плейлиста</label>
                        <input type="text" id="playlist-name" required>
                    </div>
                    <button type="submit" class="submit-btn">Создать плейлист</button>
                </form>
            </div>
        </div>

        <footer>
            <p>Создано с <span class="heart"><i class="fas fa-heart"></i></span> для тебя © 2025</p>
        </footer>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyA-qRTFlszcMafJv1eesYg-PUxsxYoo28U",
            authDomain: "misha-and-anna-48e4c.firebaseapp.com",
            databaseURL: "https://misha-and-anna-48e4c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "misha-and-anna-48e4c",
            storageBucket: "misha-and-anna-48e4c.firebasestorage.app",
            messagingSenderId: "822036073579",
            appId: "1:822036073579:web:cd59fd4f5362b5f0bb752e",
            measurementId: "G-XR86X6PXMX"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let songs = [];
        let playlists = [{ id: 'all', name: 'Все песни', songs: [] }];
        let currentSongId = null;
        let audioElement = new Audio();
        let playbackQueue = [];
        let currentPlaylistId = 'all';

        const playlistContainer = document.getElementById('playlist-container');
        const addSongBtn = document.getElementById('add-song-btn');
        const addSongModal = document.getElementById('add-song-modal');
        const closeAddModal = document.getElementById('close-add-modal');
        const addSongForm = document.getElementById('add-song-form');
        const addPlaylistBtn = document.getElementById('add-playlist-btn');
        const addPlaylistModal = document.getElementById('add-playlist-modal');
        const closePlaylistModal = document.getElementById('close-playlist-modal');
        const addPlaylistForm = document.getElementById('add-playlist-form');
        const playlistSelect = document.getElementById('playlist-select');
        const songPlaylistSelect = document.getElementById('song-playlist');

        async function loadSongs() {
            songs = [];
            const querySnapshot = await getDocs(collection(db, 'songs'));
            querySnapshot.forEach(doc => {
                songs.push({ id: parseInt(doc.id), ...doc.data() });
            });
        }

        async function loadPlaylists() {
            playlists = [{ id: 'all', name: 'Все песни', songs: songs }];
            const querySnapshot = await getDocs(collection(db, 'playlists'));
            querySnapshot.forEach(async doc => {
                const playlistData = doc.data();
                const playlistSongs = [];
                const songsSnapshot = await getDocs(collection(db, `playlists/${doc.id}/songs`));
                songsSnapshot.forEach(songDoc => {
                    playlistSongs.push({ id: parseInt(songDoc.id), ...songDoc.data() });
                });
                playlists.push({ id: doc.id, name: playlistData.name, songs: playlistSongs });
            });
        }

        function renderSongs(playlistId = 'all') {
            playlistContainer.innerHTML = '';
            let filteredSongs = playlistId === 'all' ? songs : playlists.find(p => p.id === playlistId).songs;

            if (filteredSongs.length === 0) {
                playlistContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <div class="empty-state-text">Песни не найдены</div>
                    </div>
                `;
                return;
            }

            filteredSongs.forEach(song => {
                const songCard = document.createElement('div');
                songCard.className = 'song-card';
                songCard.dataset.id = song.id;
                songCard.innerHTML = `
                    <div class="vinyl">
                        <div class="song-image" style="background-image: url('/api/placeholder/100/100')"></div>
                    </div>
                    <div class="song-content">
                        <h3 class="song-title">${song.title}</h3>
                        <p class="song-artist">Unknown Artist</p>
                        <div class="song-controls">
                            <button class="play-btn" data-id="${song.id}">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                `;
                playlistContainer.appendChild(songCard);
            });

            document.querySelectorAll('.play-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const songId = parseInt(button.getAttribute('data-id'));
                    playSong(songId, button);
                });
            });
        }

        function playSong(songId, button) {
            const songIndex = playbackQueue.findIndex(id => id === songId);
            if (songIndex === -1) {
                playbackQueue.push(songId);
            }

            if (currentSongId === songId) {
                audioElement.pause();
                button.innerHTML = '<i class="fas fa-play"></i>';
                document.querySelector(`.song-card[data-id="${songId}"]`).classList.remove('playing');
                currentSongId = null;
                playbackQueue.splice(playbackQueue.indexOf(songId), 1);
            } else {
                if (currentSongId) {
                    const prevButton = document.querySelector(`.play-btn[data-id="${currentSongId}"]`);
                    const prevSongCard = document.querySelector(`.song-card[data-id="${currentSongId}"]`);
                    prevButton.innerHTML = '<i class="fas fa-play"></i>';
                    prevSongCard.classList.remove('playing');
                }

                audioElement.pause();
                audioElement = new Audio(songs.find(s => s.id === songId).file);
                audioElement.play();
                button.innerHTML = '<i class="fas fa-pause"></i>';
                document.querySelector(`.song-card[data-id="${songId}"]`).classList.add('playing');
                currentSongId = songId;

                audioElement.onended = () => {
                    const currentIndex = playbackQueue.indexOf(songId);
                    playbackQueue.splice(currentIndex, 1);
                    button.innerHTML = '<i class="fas fa-play"></i>';
                    document.querySelector(`.song-card[data-id="${songId}"]`).classList.remove('playing');
                    currentSongId = null;

                    if (playbackQueue.length > 0) {
                        const nextSongId = playbackQueue[0];
                        const nextButton = document.querySelector(`.play-btn[data-id="${nextSongId}"]`);
                        playSong(nextSongId, nextButton);
                    }
                };
            }
        }

        async function addSong(event) {
            event.preventDefault();
            const fileInput = document.getElementById('song-file');
            const file = fileInput.files[0];
            const playlistId = document.getElementById('song-playlist').value;

            if (file) {
                const newId = songs.length > 0 ? Math.max(...songs.map(s => s.id)) + 1 : 1;
                const storageRef = ref(storage, `songs/${newId}_${file.name}`);
                await uploadBytes(storageRef, file);
                const fileURL = await getDownloadURL(storageRef);

                const newSong = {
                    id: newId,
                    title: file.name.split('.').slice(0, -1).join('.'),
                    file: fileURL
                };

                songs.push(newSong);
                await addDoc(collection(db, 'songs'), newSong);

                if (playlistId !== 'none') {
                    const playlist = playlists.find(p => p.id === playlistId);
                    playlist.songs.push(newSong);
                    await addDoc(collection(db, `playlists/${playlistId}/songs`), newSong);
                }

                addSongForm.reset();
                addSongModal.style.display = 'none';
                renderSongs(currentPlaylistId);
                updatePlaylistSelect();
            }
        }

        async function addPlaylist(event) {
            event.preventDefault();
            const name = document.getElementById('playlist-name').value;
            const newId = playlists.length > 0 ? String(Math.max(...playlists.map(p => parseInt(p.id) || 0)) + 1) : '1';
            const newPlaylist = { id: newId, name, songs: [] };
            playlists.push(newPlaylist);
            await addDoc(collection(db, 'playlists'), { name });
            addPlaylistForm.reset();
            addPlaylistModal.style.display = 'none';
            updatePlaylistSelect();
        }

        function updatePlaylistSelect() {
            playlistSelect.innerHTML = '<option value="all">Все песни</option>';
            songPlaylistSelect.innerHTML = '<option value="none">Не добавлять</option>';
            playlists.filter(p => p.id !== 'all').forEach(playlist => {
                const option = document.createElement('option');
                option.value = playlist.id;
                option.textContent = playlist.name;
                playlistSelect.appendChild(option);
                const songOption = document.createElement('option');
                songOption.value = playlist.id;
                songOption.textContent = playlist.name;
                songPlaylistSelect.appendChild(songOption);
            });
        }

        async function init() {
            await loadSongs();
            await loadPlaylists();
            renderSongs();
            updatePlaylistSelect();

            addSongBtn.addEventListener('click', () => {
                addSongModal.style.display = 'flex';
            });

            closeAddModal.addEventListener('click', () => {
                addSongModal.style.display = 'none';
                addSongForm.reset();
            });

            addPlaylistBtn.addEventListener('click', () => {
                addPlaylistModal.style.display = 'flex';
            });

            closePlaylistModal.addEventListener('click', () => {
                addPlaylistModal.style.display = 'none';
                addPlaylistForm.reset();
            });

            addSongForm.addEventListener('submit', addSong);
            addPlaylistForm.addEventListener('submit', addPlaylist);

            playlistSelect.addEventListener('change', (e) => {
                currentPlaylistId = e.target.value;
                renderSongs(currentPlaylistId);
            });

            window.addEventListener('click', (e) => {
                if (e.target === addSongModal) {
                    addSongModal.style.display = 'none';
                    addSongForm.reset();
                }
                if (e.target === addPlaylistModal) {
                    addPlaylistModal.style.display = 'none';
                    addPlaylistForm.reset();
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
